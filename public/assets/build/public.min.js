!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";let t=new Object;t={$:jQuery,action:{toast:null,cart:null},api:{event:null}},window.addonifyFloatingCart=t;const e=addonifyFloatingCartJSObject.ajax_url,o=addonifyFloatingCartJSObject.nonce,a=addonifyFloatingCartJSObject.ajax_refresh_cart_fragments,n=addonifyFloatingCartJSObject.ajax_update_cart_item_action,r=addonifyFloatingCartJSObject.ajax_remove_from_cart_action,i=addonifyFloatingCartJSObject.ajax_restore_in_cart_action,d="1"===addonifyFloatingCartJSObject.open_cart_modal_immediately_after_add_to_cart,c="1"===addonifyFloatingCartJSObject.open_cart_modal_after_click_on_view_cart,s="1"===addonifyFloatingCartJSObject.openCartModalOnTriggerButtonHover,l="1"===addonifyFloatingCartJSObject.hideTriggerButtonIfCartIsEmpty,f="1"===addonifyFloatingCartJSObject.addonifyFloatingCartNotifyShow,u=addonifyFloatingCartJSObject.addonifyFloatingCartNotifyDuration,p="1"===addonifyFloatingCartJSObject.addonifyFloatingCartNotifyDismissible,m=addonifyFloatingCartJSObject.toast_notification_display_position.split("-");addonifyFloatingCartJSObject.displayToastNotificationButton;const _=addonifyFloatingCartJSObject.ajax_apply_coupon,y=addonifyFloatingCartJSObject.ajax_remove_coupon;function g(t){if(!t)throw new Error("Spinner action state is required!");const e=document.getElementById("adfy__woofc-spinner-container");e&&("show"===t?(e.classList.add("visible"),e.classList.remove("hidden")):(e.classList.add("hidden"),e.classList.remove("visible")))}addonifyFloatingCartJSObject.states;const{$:h,action:w,api:v}=t;const C=async()=>{try{g("show");const{fragments:n}=await h.ajax({type:"POST",dataType:"json",url:e,data:{action:a,nonce:o}});if(!n)throw new Error("Fragments not fetched! aborting...");h.each(n,(function(t,e){h(t).replaceWith(e)})),h(document).trigger("wc_update_cart"),t.api.event.cartUpdated(n)}catch(t){throw new Error(t)}finally{g("hide")}},{$:b,api:E}=t;const{action:F}=t;const{$:j}=t;function O(t){if(!t)throw new Error("Function [setTriggerButtonVisibility] requires action!");const e=document.getElementById("adfy__woofc-trigger");e&&e.hasAttribute("data_display")&&("hide"===t?e.setAttribute("data_display","hidden"):e.setAttribute("data_display","visible"))}const{$:S}=t;function k(){S(document).on("click",".adfy__woofc-prevent-default",(function(t){t.preventDefault()})),S(document).on("click",".adfy__show-woofc",(function(e){t.action.cart.open(e)})),s&&S(document).on("mouseover",".adfy__show-woofc",(function(e){t.action.cart.open(e)})),c&&S(document).on("click",".added_to_cart.wc-forward",(function(e){t.action.cart.open(e)})),S(document).on("click",".adfy__hide-woofc",(function(e){e.preventDefault(),t.action.cart.close(e)})),document.addEventListener("addonifyFloatingCartUpdated",(()=>{(()=>{const e=j("#adfy__floating-cart .adfy__woofc-shipping-bar .progress-bars .live-progress-bar");e&&(parseInt(e.attr("data_percentage"))>=100?(e.addClass("hide-animation"),t.api.event.shoppingMeterThresholdReached()):e.removeClass("hide-animation"))})()})),document.addEventListener("addonifyFloatingCartItemRestored",(()=>{l&&O("show")}))}const{$:x}=t;const T=()=>{const t=document.getElementById("adfy__woofc-scrollbar"),e=t.classList.contains("ps");t&&!e&&new PerfectScrollbar(t,{wheelSpeed:1,wheelPropagation:!0,minScrollbarLength:20})},{$:q}=t;function J(t="hide",e="info",o=""){let a;const n=q("#adfy__floating-cart #adfy__woofc-cart-errors"),r=()=>{clearTimeout(a),n.hasClass("error")&&n.removeClass("error"),n.html(" ").addClass("hidden")};if("show"===t){if(!o)throw new Error("Alert message is required!");"error"===e?n.addClass("error"):n.removeClass("error"),n.html(" ").html(o).removeClass("hidden"),clearTimeout(a),a=setTimeout((()=>{r(),clearTimeout(a)}),1e4)}else r()}function M(t,e=null){if(!t)throw new Error("Coupon alert action is required!");let o=q("#adfy__floating-cart .adfy__woofc-alert");const a=()=>{let t;clearTimeout(t),t=setTimeout((()=>{q(o).fadeOut(),clearTimeout(t)}),1e4)};if("hide"!==t){if(o.length>0){const t={success:'<svg fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>',error:'<svg fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>'};if(!e)throw new Error("Coupon alert data is required!");const{style:o,message:n}=e;if(!o||!n)throw new Error("Coupon alert style & message is required!");let r;switch(o){case"success":r=`<p class="adfy__woofc-alert-text">\n                        ${t.success}\n                        ${n}\n                    </p>`,q(".adfy__woofc-alert.success").html(" ").html(r).fadeIn(),a();break;case"error":r=`<p class="adfy__woofc-alert-text">\n                        ${t.error}\n                        ${n}\n                    </p>`,q(".adfy__woofc-alert.error").html(" ").html(r).fadeIn(),a()}}}else a()}const{$:A}=t,{__:R}=wp.i18n;async function D(a,r,i=1){if(!a)throw new Error("Function [updateCartViaAjax] requires current element!");if(!r)throw new Error("Function [updateCartViaAjax] requires action!");let d;switch(r){case"add":d=A(a).next();break;case"sub":d=A(a).prev();break;default:d=A(a)}let c=A(a).attr("data-product_id"),s=A(a).attr("data-cart_item_key"),l=A(a).parents(".adfy__woofc-item");g("show");try{const a=await A.ajax({type:"POST",dataType:"json",url:e,data:{action:n,product_id:c,cart_item_key:s,nonce:o,type:r,quantity:i}});if(!a||a.error)throw new Error("Error updating cart via AJAX!");let f=a.fragments;f&&A.each(f,(function(t,e){A(t).replaceWith(e)}));let u=a.nQuantity;"OoS"===u?(alert("Out of stock range"),d.val(u)):"nil"!==u&&d.val(u),l.find(A(".adfy__woofc-item-price-multiplier-quantity")).html(u),l.unblock(),A(document.body).trigger("wc_update_cart"),t.api.event.cartUpdated(a)}catch(e){const o=R("Error processing product quantity update request!","addonify-floating-cart");throw t.action.toast.dispatch("error",o),new Error(e)}finally{g("hide")}}const{$:I}=t;function $(){const e=I("#adfy__woofc-coupon-container");I(document).on("click","#adfy__woofc-coupon-trigger",(function(o){o.preventDefault(),e.attr("data_display","visible"),t.api.event.couponModalOpened()})),I(document).on("click","#adfy__woofc-hide-coupon-container",(function(o){o.preventDefault(),e.attr("data_display","hidden"),t.api.event.couponModalClosed()}))}function U(){const{__:a}=wp.i18n;let n;I(document).on("submit","#adfy__woofc-coupon-form",(function(r){r.preventDefault();let i=I(this).find("input[name=adfy__woofc-coupon-input-field]"),d=i.val();I.ajax({url:e,method:"post",data:{action:_,nonce:o,form_data:d},success:function(e){let o=JSON.parse(e);if(!o)return n=a("Error processing coupon request.","addonify-floating-cart"),void t.action.toast.dispatch("error",n);const{appliedCoupons:r,couponApplied:d,html:c,status:s}=o,l=I(".adfy__woofc-cart-summary ul li.sub-total"),f=I(".adfy__woofc-cart-summary ul li.discount");d?d&&(i.val(""),I.each(c,(function(t,e){I(t).replaceWith(e)})),M("show",{style:"success",message:s}),t.api.event.couponApplied(o),r>0&&(l.removeClass("adfy__woofc-hidden"),f.removeClass("adfy__woofc-hidden"))):M("show",{style:"error",message:s})},error:function(e){console.log(e),n=a("Error processing coupon request.","addonify-floating-cart"),t.action.toast.dispatch("error",n),M("show",{style:"error",message:n})}})}))}function L(){const{__:a}=wp.i18n;let n;I(document).on("click",".adfy__woofc-remove-applied-coupon-button",(function(r){r.preventDefault();let i=I(this).closest("li"),d=I(this).attr("data-coupon");I.ajax({url:e,method:"post",data:{action:y,nonce:o,form_data:d},success:function(e){let o=JSON.parse(e);if(console.log(o),!o)return n=a("Error processing coupon request.","addonify-floating-cart"),void M("show",{style:"error",message:n});const{appliedCoupons:r,couponRemoved:d,html:c,status:s}=o;if(d){const e=I(".adfy__woofc-cart-summary ul li.sub-total"),a=I(".adfy__woofc-cart-summary ul li.discount");I.each(c,(function(t,e){I(t).replaceWith(e)})),M("show",{style:"success",message:s}),i.remove(),t.api.event.couponRemoved(o),r>0&&(e.removeClass("adfy__woofc-hidden"),a.removeClass("adfy__woofc-hidden"))}},error:function(t){console.log(t),n=a("Error processing coupon request.","addonify-floating-cart"),M("show",{style:"error",message:n})}})}))}document.addEventListener("DOMContentLoaded",(function(){(()=>{const t=document.getElementById("adfy__floating-cart");new MutationObserver((t=>{t.length>0&&T()})).observe(t,{attributes:!1,childList:!0,subtree:!0})})()})),function(a){w.cart={open:t=>{t.preventDefault(),h("body").addClass("adfy__woofc-visible"),v.event.cartOpened(t)},close:t=>{t.preventDefault(),h("body").removeClass("adfy__woofc-visible"),v.event.cartClosed(t)},refresh:()=>{C()}},E.event={cartOpened:t=>{b(document).trigger("addonifyFloatingCartOpened"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartOpened"))},cartClosed:t=>{b(document).trigger("addonifyFloatingCartClosed"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartClosed"))},cartUpdated:t=>{b(document).trigger("addonifyFloatingCartUpdated",t),document.dispatchEvent(new CustomEvent("addonifyFloatingCartUpdated",{detail:t}))},cartEmptied:()=>{b(document).trigger("addonifyFloatingCartEmptied"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartEmptied")),b(document).trigger("wc_cart_emptied")},productRemoved:e=>{b(document).trigger("addonifyFloatingCartProductRemoved",e),document.dispatchEvent(new CustomEvent("addonifyFloatingCartProductRemoved",{detail:e})),t.api.event.cartUpdated(data)},productRestored:e=>{b(document).trigger("addonifyFloatingCartProductRestored",e),document.dispatchEvent(new CustomEvent("addonifyFloatingCartProductRestored",{detail:e})),t.api.event.cartUpdated(data)},couponModalOpened:()=>{b(document).trigger("addonifyFloatingCartCouponModalOpened"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartCouponModalOpened"))},couponModalClosed:()=>{b(document).trigger("addonifyFloatingCartCouponModalClosed"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartCouponModalClosed"))},couponApplied:e=>{b(document).trigger("addonifyFloatingCartCouponApplied",e),document.dispatchEvent(new CustomEvent("addonifyFloatingCartCouponApplied",{detail:e})),t.api.event.cartUpdated(e)},couponRemoved:e=>{b(document).trigger("addonifyFloatingCartCouponRemoved",e),document.dispatchEvent(new CustomEvent("addonifyFloatingCartCouponRemoved",{detail:e})),t.api.event.cartUpdated(e)},shippingAddressUpdated:t=>{},shoppingMeterThresholdReached:()=>{b(document).trigger("addonifyFloatingCartShoppingMeterThresholdReached"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartShoppingMeterThresholdReached"))}},F.toast={dispatch:(t="success",e)=>{if("undefined"!=typeof Notyf){let o=new Notyf({duration:u,dismissible:p,ripple:!0,position:{x:m[1],y:m[0]}});if(!e)throw new Error("Notification toast data/message is empty, bailing out...");"success"===t&&f&&o.success({className:"adfy__woofc-notfy-success",message:e}),"error"===t&&o.error({className:"adfy__woofc-notfy-error",message:e})}}},a(document).ready((function(){C(),k(),x(document).on("added_to_cart",(function(e,o,a,n){d&&t.action.cart.open(e)})),x(document).on("wc_cart_emptied",(function(t){l&&O("hide")})),A(document).on("click",".adfy__woofc-item .adfy__woofc-inc-quantity",(function(t){t.preventDefault();const e=A(this).prev();(parseInt(e.val())<parseInt(e.attr("max"))||""===e.attr("max"))&&D(this,"add")})),A(document).on("click",".adfy__woofc-item .adfy__woofc-dec-quantity",(function(t){t.preventDefault();const e=A(this).next();parseInt(e.val())<=parseInt(e.attr("min"))||D(this,"sub")})),A(document).on("change",".adfy__woofc-item .adfy__woofc-quantity-input-field",(function(t){t.preventDefault(),D(this,"update",A(this).val())})),A(document).on("click",".adfy__woofc-item .thumb .product-remove",(function(a){a.preventDefault();const n=A(this).attr("data-product_id"),i=A(this).attr("data-cart_item_key"),d=A(this);g("show"),A.ajax({type:"POST",dataType:"json",url:e,data:{action:r,product_id:n,cart_item_key:i,nonce:o},success:function(e){if(!e||e.error)throw new Error("Error removing product from cart!");A(".post-"+n).find("a.wc-forward").remove(),A(".post-"+n).find("a.add_to_cart_button").removeClass("added");let o=e.fragments;o&&A.each(o,(function(t,e){A(t).replaceWith(e)})),J("show","info",e.undo_product_link),0===e.cart_items_count&&(t.api.event.cartEmptied(),A(".adfy__woofc-content-entry").html(e.empty_cart_message)),A(document).trigger("removed_from_cart",[e.fragments,e.cart_hash,d]),A(document).trigger("wc_update_cart"),t.api.event.cartUpdated(e)},error:function(e){console.log(e);const o=R("Error processing product removal request!","addonify-floating-cart");t.action.toast.dispatch("error",o)},always:function(){g("hide")}})})),A(document).on("click","#adfy__woofc_restore_item",(function(a){a.preventDefault();const n=A(this).attr("data-item_key");g("show"),A.ajax({type:"POST",dataType:"json",url:e,data:{action:i,cart_item_key:n,nonce:o},success:function(e){if(!e.fragments||e.error)throw new Error("Error restoring product to cart!");const o=e.fragments,a=A(".adfy__woofc-colophon"),n=A(".adfy__woofc-shipping-bar");o&&A.each(o,(function(t,e){A(t).replaceWith(e)})),a.hasClass("adfy__woofc-hidden")&&a.removeClass("adfy__woofc-hidden"),n.hasClass("adfy__woofc-hidden")&&n.removeClass("adfy__woofc-hidden"),t.api.event.productRestored(o),J("hide")},error:function(e){console.log(e);const o=R("Error processing product restore request!","addonify-floating-cart");t.action.toast.dispatch("error",o)},always:function(){g("hide")}})})),$(),U(),L()}))}(jQuery)}));
