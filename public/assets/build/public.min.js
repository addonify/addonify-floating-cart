!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";let t=new Object;t={$:jQuery,action:{toast:null,cart:null},api:{event:null}},window.addonifyFloatingCart=t;const o=addonifyFloatingCartJSObject.ajax_url,e=addonifyFloatingCartJSObject.nonce,a=addonifyFloatingCartJSObject.ajax_refresh_cart_fragments,n=addonifyFloatingCartJSObject.ajax_update_cart_item_action,i=addonifyFloatingCartJSObject.ajax_remove_from_cart_action,r=addonifyFloatingCartJSObject.ajax_restore_in_cart_action,c="1"===addonifyFloatingCartJSObject.open_cart_modal_immediately_after_add_to_cart,d="1"===addonifyFloatingCartJSObject.open_cart_modal_after_click_on_view_cart,s="1"===addonifyFloatingCartJSObject.openCartModalOnTriggerButtonHover,l="1"===addonifyFloatingCartJSObject.hideTriggerButtonIfCartIsEmpty,f="1"===addonifyFloatingCartJSObject.addonifyFloatingCartNotifyShow,p=addonifyFloatingCartJSObject.addonifyFloatingCartNotifyDuration,u="1"===addonifyFloatingCartJSObject.addonifyFloatingCartNotifyDismissible,_=addonifyFloatingCartJSObject.toast_notification_display_position.split("-"),m="1"===addonifyFloatingCartJSObject.displayToastNotificationButton,h=addonifyFloatingCartJSObject.addonifyFloatingCartNotifyMessage,y=addonifyFloatingCartJSObject.toastNotificationButton,g=addonifyFloatingCartJSObject.ajax_apply_coupon,w=addonifyFloatingCartJSObject.ajax_remove_coupon,v=addonifyFloatingCartJSObject.updateShippingInfo,C=addonifyFloatingCartJSObject.states;function b(t){if(!t)throw new Error("Spinner action is required!");const o=document.getElementById("adfy__woofc-spinner-container");o&&("show"===t?(o.classList.add("visible"),o.classList.remove("hidden")):(o.classList.add("hidden"),o.classList.remove("visible")))}const{$:E,action:F,api:j}=t;const O=async()=>{try{b("show");const{fragments:n}=await E.ajax({type:"POST",dataType:"json",url:o,data:{action:a,nonce:e}});if(!n)throw new Error("Fragments not fetched! aborting...");E.each(n,(function(t,o){E(t).replaceWith(o)})),E(document).trigger("wc_update_cart"),t.api.event.cartUpdated(n)}catch(t){throw new Error(t)}finally{b("hide")}},{$:S,api:T}=t;const{action:k}=t;const{$:x}=t;function q(t){if(!t)throw new Error("Function [setShoppingMeterVisibility] requires action!");const o=x("#adfy__floating-cart .adfy__woofc-shipping-bar");o.length>0&&("hide"===t?o.addClass("adfy__woofc-hidden"):o.removeClass("adfy__woofc-hidden"))}function J(t){if(!t)throw new Error("Function [setTriggerButtonVisibility] requires action!");const o=document.getElementById("adfy__woofc-trigger");o&&o.hasAttribute("data_display")&&("hide"===t?o.setAttribute("data_display","hidden"):o.setAttribute("data_display","visible"))}const{$:D}=t;function M(){D(document).on("click",".adfy__woofc-prevent-default",(function(t){t.preventDefault()})),D(document).on("click",".adfy__show-woofc",(function(o){t.action.cart.open(o)})),D(document).on("mouseover",".adfy__show-woofc",(function(o){s&&t.action.cart.open(o)})),D(document).on("click",".added_to_cart.wc-forward",(function(o){d&&(o.preventDefault(),t.action.cart.open(o))})),D(document).on("click",".adfy__hide-woofc",(function(o){o.preventDefault(),t.action.cart.close(o)})),document.addEventListener("addonifyFloatingCartUpdated",(()=>{(()=>{const o=x("#adfy__floating-cart .adfy__woofc-shipping-bar .progress-bars .live-progress-bar");o&&(parseInt(o.attr("data_percentage"))>=100?(o.addClass("hide-animation"),t.api.event.shoppingMeterThresholdReached()):o.removeClass("hide-animation"))})()})),document.addEventListener("addonifyFloatingCartItemRestored",(()=>{l&&J("show")}))}const{$:A}=t;function L(t="hide",o="info",e=""){let a;const n=A("#adfy__floating-cart #adfy__woofc-cart-errors"),i=()=>{clearTimeout(a),n.hasClass("error")&&n.removeClass("error"),n.html(" ").addClass("hidden")};if("show"===t){if(!e)throw new Error("Alert message is required!");"error"===o?n.addClass("error"):n.removeClass("error"),n.html(" ").html(e).removeClass("hidden"),clearTimeout(a),a=setTimeout((()=>{i(),clearTimeout(a)}),1e4)}else i()}function R(t,o=null){if(!t)throw new Error("Coupon alert action is required!");let e=A("#adfy__floating-cart .adfy__woofc-alert");const a=()=>{let t;clearTimeout(t),t=setTimeout((()=>{A(e).fadeOut(),clearTimeout(t)}),1e4)};if("hide"!==t){if(e.length>0){const t={success:'<svg fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>',error:'<svg fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>'};if(!o)throw new Error("Coupon alert data is required!");const{style:e,message:n}=o;if(!e||!n)throw new Error("Coupon alert style & message is required!");let i;switch(e){case"success":i=`<p class="adfy__woofc-alert-text">\n                        ${t.success}\n                        ${n}\n                    </p>`,A(".adfy__woofc-alert.success").html(" ").html(i).fadeIn(),a();break;case"error":i=`<p class="adfy__woofc-alert-text">\n                        ${t.error}\n                        ${n}\n                    </p>`,A(".adfy__woofc-alert.error").html(" ").html(i).fadeIn(),a()}}}else a()}function I(t="hide",o=null){if("string"!=typeof t)throw new Error("Colophon visibility must be a string value.");const e=document.querySelector(".adfy__woofc-colophon"),a=document.querySelector(".adfy__woofc-cart-summary ul li.discount"),n=document.querySelector(".adfy__woofc-cart-summary ul li.sub-total"),i="adfy__woofc-hidden";if(e&&("show"===t?e.classList.remove(i):e.classList.add(i)),e&&"show"===t){const{discountVisibility:t,subTotalVisibility:e}=o;a&&t&&("show"===t?a.classList.remove(i):a.classList.add(i)),n&&("show"===e?n.classList.remove(i):n.classList.add(i))}}const{$:U}=t;function N(){U(document).on("added_to_cart",(function(o,e){c&&t.action.cart.open(o),l&&J("show"),f&&function(o){if(!o||"object"!=typeof o)throw new Error("Toast message data invalid!");if(o&&"object"==typeof o){let e,a;a=Object.hasOwn(o,"product")?o.product.charAt(0).toUpperCase()+o.product.slice(1):__("Product","addonify-floating-cart"),e=m?h.replace("{product_name}",a)+" "+y:h.replace("{product_name}",a),t.action.toast.dispatch("success",e)}}(e),L("hide"),q("show"),I("show",{discountVisibility:"show",subTotalVisibility:"show"}),t.api.event.cartUpdated(e)})),U(document).on("wc_cart_emptied",(function(o){l&&J("hide"),q("hide"),I("hide"),t.api.event.cartUpdated(o)}))}const $=()=>{const t=document.getElementById("adfy__woofc-scrollbar"),o=t.classList.contains("ps");t&&!o&&new PerfectScrollbar(t,{wheelSpeed:1,wheelPropagation:!0,minScrollbarLength:20})},{$:P}=t,{__:B}=wp.i18n;function V(a,i,r=1){if(!a)throw new Error("Function [updateCartViaAjax] requires current element!");if(!i)throw new Error("Function [updateCartViaAjax] requires action!");let c;switch(i){case"add":c=P(a).next();break;case"sub":c=P(a).prev();break;default:c=P(a)}let d=P(a).attr("data-product_id"),s=P(a).attr("data-cart_item_key"),l=P(a).parents(".adfy__woofc-item");b("show"),P.ajax({type:"POST",dataType:"json",url:o,data:{action:n,product_id:d,cart_item_key:s,nonce:e,type:i,quantity:r},success:function(o){if(!o||o.error)throw new Error("Error updating cart via AJAX!");let e=o.fragments;e&&P.each(e,(function(t,o){P(t).replaceWith(o)}));let a=o.nQuantity;"OoS"===a?(alert("Out of stock range"),c.val(a)):"nil"!==a&&c.val(a),l.find(P(".adfy__woofc-item-price-multiplier-quantity")).html(a),l.unblock(),P(document.body).trigger("wc_update_cart"),t.api.event.cartUpdated(o)},error:function(o){const{__:e}=wp.i18n,a=e("Error processing cart update request!","addonify-floating-cart");throw t.action.toast.dispatch("error",a),new Error(o)},complete:function(){b("hide")}})}const{$:W}=t;const{$:z}=t;function Q(){z(document).on("click","#adfy__woofc-shipping-trigger",(function(t){t.preventDefault(),z("#adfy__woofc-shipping-container").attr("data_display","visible")})),z(document).on("click","#adfy__woofc-hide-shipping-container",(function(t){t.preventDefault(),z("#adfy__woofc-shipping-container").attr("data_display","hidden")})),z(document).on("click","#adfy__woofc-shipping-form .adfy__woofc-shipping-address-form-toggle-button",(function(t){t.preventDefault(),"none"===z(".adfy__woofc-shipping-form-elements").css("display")?z(".adfy__woofc-shipping-form-elements").show():z(".adfy__woofc-shipping-form-elements").hide()})),z(document).on("change","#addonify_floating_cart_shipping_country",(function(t){let o=z(this).val(),e=z("#addonify_floating_cart_shipping_state"),a=C[o];if(e.siblings("span.select2").remove(),"object"==typeof a&&Object.keys(a).length>0){let t="";for(let o in a)t+='<option value="'+o+'">'+a[o]+"</option>";if("input"===e.prop("tagName").toLowerCase()){let t=e.parent();e.remove();let o=z(document.createElement("select"));o.addClass("state_select").prop("id","addonify_floating_cart_shipping_state").prop("name","addonify_floating_cart_shipping_state"),o.prop("data-placeholder","State / County"),t.append(o)}z("#addonify_floating_cart_shipping_state").html(t)}else if(a instanceof Array&&0===a.length){let t=e.parent();e.remove();let o=z(document.createElement("input"));o.addClass("input_text").prop("id","addonify_floating_cart_shipping_state").prop("name","addonify_floating_cart_shipping_state"),o.prop("type","hidden"),t.append(o)}else{let t=e.parent();e.remove();let o=z(document.createElement("input"));o.addClass("input_text").prop("id","addonify_floating_cart_shipping_state").prop("name","addonify_floating_cart_shipping_state"),o.prop("placeholder","State / County"),t.append(o)}}))}function H(){z(document).on("submit","#adfy__woofc-shipping-form",(function(e){e.preventDefault();let a=z("#addonify_floating_cart_shipping_country").val(),n=z("#addonify_floating_cart_shipping_state").val(),i=z("#addonify_floating_cart_shipping_city").val(),r=z("#addonify_floating_cart_shipping_postcode").val(),c=z("#addonify-floating-cart-shipping-nonce").val();const{__:d}=wp.i18n;let s=d("Error updating shipping address!.","addonify-floating-cart");z.ajax({url:o,method:"POST",data:{action:v,calc_shipping_country:a,calc_shipping_state:n,calc_shipping_city:i,calc_shipping_postcode:r,nonce:c},success:function(o){o?o.fragments&&z.each(o.fragments,(function(t,o){""!==o?z(t).replaceWith(o):z(t).html(o)})):t.action.toast.dispatchToast("error",s)},error:function(o){console.log(o),t.action.toast.dispatchToast("error",s)}})}))}function X(){z(document).on("change",".shipping_method",(function(a){const{__:n}=wp.i18n;let i=new Object,r=n("Error processing shipping method update request.","addonify-floating-cart");z("select.shipping_method, :input[name^=shipping_method][type=radio]:checked, :input[name^=shipping_method][type=hidden]").each((function(){i[z(this).data("index")]=z(this).val()})),b("hide"),z.ajax({url:o,method:"POST",data:{action:v,nonce:e,shipping_method:i},success:function(o){if(!o||o.error)return void t.action.toast.dispatch("error",r);let e=o.fragments;e&&z.each(e,(function(t,o){""!==o?z(t).replaceWith(o):z(t).html(o)}))},error:function(o){console.log(o),t.action.toast.dispatch("error",r)},complete:function(){b("hide")}})}))}document.addEventListener("DOMContentLoaded",(function(){(()=>{const t=document.getElementById("adfy__floating-cart");new MutationObserver((t=>{t.length>0&&$()})).observe(t,{attributes:!1,childList:!0,subtree:!0})})()})),function(a){F.cart={open:t=>{t.preventDefault(),E("body").addClass("adfy__woofc-visible"),j.event.cartOpened(t)},close:t=>{t.preventDefault(),E("body").removeClass("adfy__woofc-visible"),j.event.cartClosed(t)},refresh:()=>{O()}},T.event={cartOpened:t=>{S(document).trigger("addonifyFloatingCartOpened"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartOpened"))},cartClosed:t=>{S(document).trigger("addonifyFloatingCartClosed"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartClosed"))},cartUpdated:t=>{S(document).trigger("addonifyFloatingCartUpdated",t),document.dispatchEvent(new CustomEvent("addonifyFloatingCartUpdated",{detail:t}))},cartEmptied:()=>{S(document).trigger("addonifyFloatingCartEmptied"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartEmptied")),S(document).trigger("wc_cart_emptied")},productRemoved:o=>{S(document).trigger("addonifyFloatingCartProductRemoved",o),document.dispatchEvent(new CustomEvent("addonifyFloatingCartProductRemoved",{detail:o})),t.api.event.cartUpdated(data)},productRestored:o=>{S(document).trigger("addonifyFloatingCartProductRestored",o),document.dispatchEvent(new CustomEvent("addonifyFloatingCartProductRestored",{detail:o})),t.api.event.cartUpdated(o)},couponModalOpened:()=>{S(document).trigger("addonifyFloatingCartCouponModalOpened"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartCouponModalOpened"))},couponModalClosed:()=>{S(document).trigger("addonifyFloatingCartCouponModalClosed"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartCouponModalClosed"))},couponApplied:o=>{S(document).trigger("addonifyFloatingCartCouponApplied",o),document.dispatchEvent(new CustomEvent("addonifyFloatingCartCouponApplied",{detail:o})),t.api.event.cartUpdated(o)},couponRemoved:o=>{S(document).trigger("addonifyFloatingCartCouponRemoved",o),document.dispatchEvent(new CustomEvent("addonifyFloatingCartCouponRemoved",{detail:o})),t.api.event.cartUpdated(o)},shippingAddressUpdated:t=>{},shoppingMeterThresholdReached:()=>{S(document).trigger("addonifyFloatingCartShoppingMeterThresholdReached"),document.dispatchEvent(new CustomEvent("addonifyFloatingCartShoppingMeterThresholdReached"))}},k.toast={dispatch:(t="success",o)=>{if("undefined"!=typeof Notyf){let e=new Notyf({duration:p,dismissible:u,ripple:!0,position:{x:_[1],y:_[0]}});if(!o)throw new Error("Notification toast data/message is empty, bailing out...");"error"===t&&e.error({className:"adfy__woofc-notfy-error",message:o}),f&&"success"===t&&e.success({className:"adfy__woofc-notfy-success",message:o})}}},a(document).ready((function(){O(),M(),N(),P(document).on("click",".adfy__woofc-item .adfy__woofc-inc-quantity",(function(t){t.preventDefault();const o=P(this).prev();(parseInt(o.val())<parseInt(o.attr("max"))||""===o.attr("max"))&&V(this,"add")})),P(document).on("click",".adfy__woofc-item .adfy__woofc-dec-quantity",(function(t){t.preventDefault();const o=P(this).next();parseInt(o.val())<=parseInt(o.attr("min"))||V(this,"sub")})),P(document).on("change",".adfy__woofc-item .adfy__woofc-quantity-input-field",(function(t){t.preventDefault(),V(this,"update",P(this).val())})),P(document).on("click",".adfy__woofc-item .thumb .product-remove",(function(a){a.preventDefault();const n=P(this).attr("data-product_id"),r=P(this).attr("data-cart_item_key"),c=P(this);b("show"),P.ajax({type:"POST",dataType:"json",url:o,data:{action:i,product_id:n,cart_item_key:r,nonce:e},success:function(o){if(!o||o.error)throw new Error("Error removing product from cart!");P(".post-"+n).find("a.wc-forward").remove(),P(".post-"+n).find("a.add_to_cart_button").removeClass("added");let e=o.fragments;e&&P.each(e,(function(t,o){P(t).replaceWith(o)})),L("show","info",o.undo_product_link),0===o.cart_items_count&&(t.api.event.cartEmptied(),P(".adfy__woofc-content-entry").html(o.empty_cart_message)),P(document).trigger("removed_from_cart",[o.fragments,o.cart_hash,c]),P(document).trigger("wc_update_cart"),t.api.event.cartUpdated(o)},error:function(o){console.log(o);const e=B("Error processing product removal request!","addonify-floating-cart");t.action.toast.dispatch("error",e)},complete:function(){b("hide")}})})),P(document).on("click","#adfy__woofc_restore_item",(function(a){a.preventDefault();const n=P(this).attr("data-item_key");b("show"),P.ajax({type:"POST",dataType:"json",url:o,data:{action:r,cart_item_key:n,nonce:e},success:function(o){if(!o.fragments||o.error)throw new Error("Error restoring product to cart!");const e=o.fragments,a=P(".adfy__woofc-colophon"),n=P(".adfy__woofc-shipping-bar");e&&P.each(e,(function(t,o){P(t).replaceWith(o)})),a.hasClass("adfy__woofc-hidden")&&a.removeClass("adfy__woofc-hidden"),n.hasClass("adfy__woofc-hidden")&&n.removeClass("adfy__woofc-hidden"),t.api.event.productRestored(e),L("hide")},error:function(o){console.log(o);const e=B("Error processing product restore request!","addonify-floating-cart");t.action.toast.dispatch("error",e)},complete:function(){b("hide")}})})),function(){const o=W("#adfy__woofc-coupon-container");W(document).on("click","#adfy__woofc-coupon-trigger",(function(e){e.preventDefault(),o.attr("data_display","visible"),t.api.event.couponModalOpened()})),W(document).on("click","#adfy__woofc-hide-coupon-container",(function(e){e.preventDefault(),o.attr("data_display","hidden"),t.api.event.couponModalClosed()}))}(),function(){const{__:a}=wp.i18n;let n;W(document).on("submit","#adfy__woofc-coupon-form",(function(i){i.preventDefault();let r=W(this).find("input[name=adfy__woofc-coupon-input-field]"),c=r.val();W.ajax({url:o,method:"post",data:{action:g,nonce:e,form_data:c},success:function(o){let e=JSON.parse(o);if(!e)return n=a("Error processing coupon request.","addonify-floating-cart"),void R("show",{style:"error",message:n});const{appliedCoupons:i,couponApplied:c,html:d,status:s}=e,l=W(".adfy__woofc-cart-summary ul li.sub-total"),f=W(".adfy__woofc-cart-summary ul li.discount");c?c&&(r.val(""),W.each(d,(function(t,o){W(t).replaceWith(o)})),R("show",{style:"success",message:s}),t.api.event.couponApplied(e),i>0&&(l.removeClass("adfy__woofc-hidden"),f.removeClass("adfy__woofc-hidden"))):R("show",{style:"error",message:s})},error:function(o){console.log(o),n=a("Error processing coupon request.","addonify-floating-cart"),t.action.toast.dispatch("error",n),R("show",{style:"error",message:n})}})}))}(),function(){const{__:a}=wp.i18n;let n;W(document).on("click",".adfy__woofc-remove-applied-coupon-button",(function(i){i.preventDefault();let r=W(this).closest("li"),c=W(this).attr("data-coupon");W.ajax({url:o,method:"post",data:{action:w,nonce:e,form_data:c},success:function(o){let e=JSON.parse(o);if(!e)return n=a("Error processing coupon request.","addonify-floating-cart"),void R("show",{style:"error",message:n});const{appliedCoupons:i,couponRemoved:c,html:d,status:s}=e;if(c){const o=W(".adfy__woofc-cart-summary ul li.sub-total"),a=W(".adfy__woofc-cart-summary ul li.discount");W.each(d,(function(t,o){W(t).replaceWith(o)})),R("show",{style:"success",message:s}),r.remove(),t.api.event.couponRemoved(e),i>0&&(o.removeClass("adfy__woofc-hidden"),a.removeClass("adfy__woofc-hidden"))}},error:function(t){console.log(t),n=a("Error processing coupon request.","addonify-floating-cart"),R("show",{style:"error",message:n})}})}))}(),Q(),H(),X()}))}(jQuery)}));
